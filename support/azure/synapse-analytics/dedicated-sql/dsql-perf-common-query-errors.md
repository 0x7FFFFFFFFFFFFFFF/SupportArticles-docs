---
title: Troubleshoot common query execution errors on an Azure Synapse dedicated SQL pool
description: Provides a reference of the most common errors and recommendations for query execution on an Azure Synapse dedicated SQL pool.
ms.date: 06/28/2023
author: scott-epperly
ms.author: scepperl
ms.reviewer: goventur
---

# Troubleshoot Common Query Errors

_Applies to:_ &nbsp; Azure Synapse Analytics

> [!NOTE]
> Make sure to also review the [list of known issues](/azure/synapse-analytics/known-issues) currently active or recently resolved in Azure Synapse Analytics.

Use the following guidance to troubleshoot common failures, errors, and exceptions that occur when executing queries against your Azure Synapse dedicated SQL pool.

### Common errors

| Error | Cause | Mitigation |
|-------|-------|------------|
| Could not allocate a new page for database 'Distribution_xx' because of insufficient disk space in filegroup 'PRIMARY'. | Tables with rowstore indexes (not [columnstore](/sql/relational-databases/indexes/columnstore-indexes-overview#key-terms-and-concepts)) and/or heaps have exceeded available space in at least one distribution. | <ul><li>[Increase max size for the database](/sql/t-sql/statements/alter-database-transact-sql?view=azure-sqldw-latest&preserve-view=true&tabs=sqlpool#b-change-max-size-for-the-database)</li><li>[Evaluate tables for skew](/azure/synapse-analytics/sql-data-warehouse/sql-data-warehouse-tables-distribute#determine-if-the-table-has-data-skew)</li></ul> |
| Error 8632 - Internal error: An expression services limit has been reached.  Look for potentially complex expressions in your query, and try to simplify them. | The query is too complex for optimization. | <ul><li>Break the query into multiple steps</li><ul> |
| Database 'Distribution_xx_`Cache`' cannot be opened due to inaccessible files or insufficient memory or disk space. | Indicates a service health issue. | <ul><li>Pause and resume your dedicated SQL pool.</li></ul> |
| Unable to allocate _n_ KB for columnstore compression because it exceeds the remaining memory from total allocated for current resource class and DWU. | Insufficient memory for write operation. | <ul><li>[Increase the user's resource class](/azure/sql-data-warehouse/resource-classes-for-workload-management#change-a-users-resource-class)</li><li>Consider temporarily [increase SLO](/azure/synapse-analytics/sql-data-warehouse/quickstart-scale-compute-portal). |
| Internal error (5123, 50) | Occurs due to high volume IO operations. | <ul><li>[Increase the user's resource class](/azure/sql-data-warehouse/resource-classes-for-workload-management#change-a-users-resource-class)</li><li>Reduce number of partitions of the table</li><li>[Rebuild CCI tables](/troubleshoot/azure/synapse-analytics/dedicated-sql/dsql-perf-cci-health)</li></ul>
| Failed to execute query. Error: MSDTC on server '{NAME}' is unavailable | The service that manages global transactions isn't functioning appropriately. | <ul><li>Pause and resume your dedicated SQL pool for immediate mitigation.  Contact support if the issue reoccurs.</li></ul> | 
| 110806; A distributed query failed: Execution Timeout Expired.  The timeout period elapsed prior to completion of the operation or the server isn't responding | Internal metadata retrieval timeout. |  <ul><li>Replace query references to sys.pdw_table_mappings with [sys.pdw_permanent_table_mappings](/sql/relational-databases/system-catalog-views/sys-pdw-permanent-table-mappings-transact-sql) as it's more performant.</li></ul> |
| 110806; A distributed query failed: ExecuteNonQuery requires an open and available Connection. The connection's current state is open. | Internal query failure indicating connectivity issues between compute nodes. | <ul><li>Retry the query(ies) as this issue will typically self-resolve.</li><li>Pause and resume your dedicated SQL pool if issue persists</li><li>Contact support if frequency of the issue increases.</li></ul> |
| 110806; A distributed query failed: Operation not allowed. | Internal query failure typically indicating resource pressure | <ul><li>Retry the query(ies) as this issue will typically self-resolve.</li><li>Pause and resume your dedicated SQL pool if issue persists</li>[Update statistics](/troubleshoot/azure/synapse-analytics/dedicated-sql/dsql-perf-stats-accuracy) and [rebuild CCIs](/troubleshoot/azure/synapse-analytics/dedicated-sql/dsql-perf-cci-health)<li>Consider [increasing SLO](/azure/synapse-analytics/sql-data-warehouse/quickstart-scale-compute-portal).  Contact support if issue persists after increasing SLO.</li></ul> |
| 110806; A distributed query failed: Could not allocate space for object 'xxx' in database 'tempdb' because the 'PRIMARY' filegroup is full. | A query or series of queries has filled tempdb on at least one compute node. | <ul><li>See how to [Troubleshoot tempdb errors on a dedicated SQL pool](/troubleshoot/azure/synapse-analytics/dedicated-sql/dsql-perf-tempdb-errors).</li></ul> |
| 110802; An internal DMS error occurred that caused this operation to fail. Details: Please use this Error ID when contacting your Administrator for assistance. EID:(xxx) | Query failure during DMS operation due to insufficient resources. | <ul><li>[Increase the user's resource class](/azure/sql-data-warehouse/resource-classes-for-workload-management#change-a-users-resource-class) to match the workload</li><li>Review and implement [mitigations to prevent tempdb filling](/troubleshoot/azure/synapse-analytics/dedicated-sql/dsql-perf-tempdb-errors#step-2-prevent-the-recurrence) </li></ul> |
| 110802; An internal DMS error occurred that caused this operation to fail. ... Java exception message: HdfsBridge::createRecordWriter - Unexpected error encountered when creating a record writer: ClassCastException: | Occurs during ```CREATE EXTERNAL TABLE AS SELECT``` statement when the ```EXTERNAL DATA SOURCE``` is created using native data virtualization against an unsupported source.  | <ul><li>Specify TYPE = Hadoop when creating the [External Data Source](/sql/t-sql/statements/create-external-data-source-transact-sql?view=azure-sqldw-latest&preserve-view=true&tabs=dedicated)</li></ul> |
| 110802; An internal DMS error occurred that caused this operation to fail. ... Java exception message: HdfsBridge::CreateRecordReader - Unexpected error encountered creating the record reader: ConnectException: Connection timed out: | Insufficient memory resources to execute the query. | <ul><li>[Increase the user's resource class](/azure/sql-data-warehouse/resource-classes-for-workload-management#change-a-users-resource-class) to match the workload</li></ul> |
| 100088: The query processor could not produce a query plan because the target DML table is not hash partitioned | Unsupported ROUND_ROBIN distributed table DML scenario:<ul><li>DELETE from RR with PRIMARY or UNIQUE key</li><li>UPDATE utilizes a ranking function, such as ROW_NUMBER, RANK, or DENSE_RANK for determining rows to update on the target table</li></ul> | <ul><li>DELETE + PK/UK scenario: Drop PK/UK and then remove duplicate rows</li><li>UPDATE + ranking function scenario: <ul><li>Change the target table distribution type to HASH</li><li>Perform DELETE + INSERT instead of UPDATE</li></ul></ul> |
| 35386. Error Message: Unable to allocate 370216 {NAME} for columnstore compression because it exceeds the remaining memory from total allocated for current resource class and DWU | The query that is modifying or managing a table with a clustered columnstore index doesn't have sufficient memory to complete the task. | <ul><li>[Increase the user's resource class](/azure/sql-data-warehouse/resource-classes-for-workload-management#change-a-users-resource-class) to match the workload</li><li>Consider [increasing SLO](/azure/synapse-analytics/sql-data-warehouse/quickstart-scale-compute-portal).</li></ul> |

### Unexpected Behaviors

| Observation | Recommendation |
|-------------|----------------|
| Syntax errors | <ul><li>Check the [T-SQL syntax](/azure/sql-data-warehouse/sql-data-warehouse-reference-tsql-statements) reference as there are differences for dedicated SQL pools</li></ul> |
| Primary keys and unique keys not enforced | <ul><li>Primary keys and unique constraints don't enforce consistency in Synapse Analytics.  However, the query optimizer can take advantage of the key to improve query performance.</li></ul> |
| USE statement fails | <ul><li>The ```USE``` statement isn't supported on the dedicated SQL pool. Connect to the Synapse dedicated SQL pool directly in the connection string.</li></ul>
| Cancelled query or execution timeout errors | <ul><li>Check the timeout value configured on the client application.</li><li>Configure the `QUERY_EXECUTION_TIMEOUT_SEC` parameter in the [CREATE WORKLOAD GROUP](/sql/t-sql/statements/create-workload-group-transact-sql).</li></ul> |
| Inconsistent or unexpected results | <ul><li>If your data contains special characters or uses different text encodings, use Unicode data types like NCHAR and NVARCHAR.</li><li>Check if your query uses ```GETDATE()``` in the WHERE clause or JOIN operations. Use a variable to store the date, then use in the variable</li><li>Check if your query uses ```ROW_NUMBER()``` function in WHERE clause or JOIN operations. Use a temp table to hold ```ROW_NUMBER()``` function results, and then join with other tables.</li><li>Databases with a non-default collation can affect the behavior of queries and display unexpected results when interacting with third-party tooling.  **Note**: the default database collation can't be changed after creation of the dedicated SQL pool. For more information about collation support, see [Database collation support for Azure Synapse Analytics Dedicated SQL pool](/azure/synapse-analytics/sql-data-warehouse/sql-data-warehouse-reference-collation-types).</li></ul> |
| Unexpected duplicate rows | <ul><li>Drop the `PRIMARY KEY` on the table and then check for the duplicates.</li></ul> |
| Queries hang or long running queries | <ul><li>Use our article to [Troubleshoot a slow query on a dedicated SQL Pool](/troubleshoot/azure/synapse-analytics/dedicated-sql/troubleshoot-dsql-perf-slow-query)</li></ul> |
| The estimated query plan isn't eliminating the relevant partitions as expected | <ul><li>This behavior is by-design. The estimated query plan generated by the Control node doesn't take into account the seek predicates, but the individual distribution plans on the compute nodes do.</li></ul> |
| Unable to reference views in a materialized view | <ul><li>Materialized views don't support querying other views. Check [restrictions for materialized views](/sql/t-sql/statements/create-materialized-view-as-select-transact-sql?toc=%2Fazure%2Fsynapse-analytics%2Fsql-data-warehouse%2Ftoc.json&bc=%2Fazure%2Fsynapse-analytics%2Fsql-data-warehouse%2Fbreadcrumb%2Ftoc.json&view=azure-sqldw-latest&preserve-view=true#remarks).</li></ul> |
| Inconsistent durations when querying external tables | <ul><li>External tables aren't optimal for end user queries.  Instead, consider [loading data into permanent tables](/azure/sql-data-warehouse/sql-data-warehouse-best-practices#load-then-query-external-tables) for querying or switch the workload to use [serverless pools](/azure/synapse-analytics/sql/on-demand-workspace-overview) for a more consistent experience. |

### Resources
* Query the DMV [sys.dm_pdw_errors](/sql/relational-databases/system-dynamic-management-views/sys-dm-pdw-errors-transact-sql) for errors
* [Additional Troubleshooting](https://azure.microsoft.com/documentation/articles/sql-data-warehouse-troubleshoot/)
