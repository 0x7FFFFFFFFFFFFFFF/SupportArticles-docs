---
title: Error 2767 when query against the secondary replica fails
description: This article provides workarounds for the issue that query against the secondary replica fails with the error 2767 "Could not locate statistics".
ms.date: 
ms.prod-support-area-path: 
ms.reviewer: 
ms.prod: sql 
---

# Error 2767 "Could not locate statistics" when query against the secondary replica fails

_Applies to:_&nbsp; SQL Server on-premises, Azure SQL Database

This article provides workarounds for the issue that a query against the secondary replica fails with error 2767 "Could not locate statistics".

## Symptom

When offloading read-only workloads to a secondary replica of an Always On availability group from a primary replica, you notice that a query against the secondary replica fails with the following error message:

> Msg 2767, Level 16, State 1, Procedure sp_table_statistics2_rowset, Line *\<LineNum>* [Batch Start Line *\<LineNum>*]
>
> Could not locate statistics '_WA_Sys_00000011_37C5420D' in the system catalogs.

> [!NOTE]
> `_WA_Sys_00000011_37C5420D` is the statistics generated by a query (`AUTO_CREATE_STATISTICS` is set to ON) that is running on the primary replica.

## Cause

This issue occurs because an active transaction prevents the log record of cache invalidation from accessing and refreshing the statistics on the secondary replica.

## Workaround

To work around the issue, you can use one of the following methods as required:

- SQL Server on-premises

    If the issue occurs in SQL Server on-premises, you can run the following command against the secondary replica to synchronize the cached statistics with the statistics on disk:

    ```sql
    DBCC FREESYSTEMCACHE('ALL')
    GO
    ```

- Azure SQL Database

    If the issue occurs in Azure SQL Database, run the [Invoke-AzSqlDatabaseFailover](/powershell/module/az.sql/invoke-azsqldatabasefailover) cmdlet to fail over the readable secondary replica. For example:

    ```powershell
    Invoke-AzSqlDatabaseFailover -ResourceGroupName "ResourceGroup01" -ServerName "Server01" -DatabaseName "Database01" -ReadableSecondary
    ```

    This cmdlet will fail over the readable secondary replica of the database named `Database01` on the server named `Server01`.

- SQL Server on-premises or Azure SQL Database

    For a more permanent workaround, follow these steps:

    1. To determine the column and table where the query-generated statistics are created, run [DBCC SHOW_STATISTICS](/sql/t-sql/database-console-commands/dbcc-show-statistics-transact-sql) against the primary replica by using the name of the table and statistics reported in the error 2767. For example:

        ```sql
        DBCC SHOW_STATISTICS('t1', '_WA_Sys_00000011_37C5420D')
        GO
        ```

        The following results display the contents of the `_WA_Sys_00000011_37C5420D` statistics in the table `t1`, and you can see the statistics are created in the column `c1` of the table `t1`.

        |Name|Updated|
        |-|-|
        |`_WA_Sys_00000001_60A75C0F`|*\<DateTime>*|
        |||

        |All density|Average Length|Columns|
        |-|-|-|
        |0.5|4|c1|
        |||

    1. Drop the query-generated statistics.

        ```sql
        DROP STATISTICS t1._WA_Sys_00000011_37C5420D
        GO
        ```

    1. Create permanent statistics on the primary replica.

         You can run the following commands to drop the query-generated statistics, and then create statistics in the column `c1` of the table `t1`.

        ```sql
        CREATE STATISTICS t1c1 ON t1(c1)
        GO
        ```
